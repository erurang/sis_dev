"use client";

import Link from "next/link";
import { useState, useEffect, useMemo } from "react";
import { useParams, useRouter, useSearchParams } from "next/navigation";
import { supabase } from "@/lib/supabaseClient";
import { Skeleton, CircularProgress } from "@mui/material";
import { useLoginUser } from "@/context/login";
import SnackbarComponent from "@/components/Snackbar";

import { useFavorites } from "@/hooks/favorites/useFavorites";
import { useConsultationsList } from "@/hooks/consultations/useConsultationsList";
import { useCompanyDetails } from "@/hooks/consultations/useCompanyDetails";
import { useContactsByCompany } from "@/hooks/manage/customers/useContactsByCompany";
import { useConsultationContacts } from "@/hooks/consultations/useConsultationContacts";
import { useUsersList } from "@/hooks/useUserList";
import { useAddConsultation } from "@/hooks/consultations/useAddConsultation";
import { useAssignConsultationContact } from "@/hooks/consultations/useAssignConsultationContact";
import { useUpdateConsultation } from "@/hooks/consultations/useUpdateConsultation";

interface Consultation {
  id: string;
  date: string;
  content: string;
  follow_up_date: any;
  user_id: string;
  contact_name: string;
  contact_level: string;
  documents: {
    estimate: boolean;
    order: boolean;
    requestQuote: boolean;
  };
}
interface Contact {
  id: string;
  contact_name: string;
  mobile: string;
  department: string;
  level: string;
  email: string;
}

interface Company {
  id: string;
  name: string;
  address: string;
  phone: string;
  email: string;
  fax: string;
  notes: string;
  business_number: string;
}

interface User {
  id: string;
  name: string;
  level: string;
}

export default function ConsultationPage() {
  const { id } = useParams();
  const router = useRouter();
  const loginUser = useLoginUser();
  const searchParams = useSearchParams();

  const [saving, setSaving] = useState(false);
  const [snackbarMessage, setSnackbarMessage] = useState<string>("");
  const [openAddModal, setOpenAddModal] = useState(false);
  const [openEditModal, setOpenEditModal] = useState(false);
  const [newConsultation, setNewConsultation] = useState({
    date: new Date().toISOString().split("T")[0],
    follow_up_date: "",
    contact_name: "",
    user_id: "",
    content: "",
  });

  const [currentPage, setCurrentPage] = useState(1);
  const [selectedConsultation, setSelectedConsultation] =
    useState<Consultation | null>(null);

  const [openDeleteModal, setOpenDeleteModal] = useState(false);
  const [consultationToDelete, setConsultationToDelete] =
    useState<Consultation | null>(null);

  /// swr ///////
  const { users } = useUsersList();

  const { favorites, removeFavorite, refetchFavorites, addFavorite } =
    useFavorites(loginUser?.id);
  const { consultations, totalPages, refreshConsultations } =
    useConsultationsList(id as string, currentPage);

  const { companyDetail, isLoading: isCompanyDetailLoading } =
    useCompanyDetails(id as any);

  const { contacts } = useContactsByCompany([id] as any);

  const consultationIds = consultations?.map((con: any) => con.id) || [];
  const { contactsConsultations, refreshContactsConsultations } =
    useConsultationContacts(consultationIds);

  const { addConsultation, isAdding } = useAddConsultation();
  const { assignConsultationContact } = useAssignConsultationContact();

  const { updateConsultation, isUpdating } = useUpdateConsultation();

  //// swr ////////

  const processedConsultations = useMemo(() => {
    return consultations?.map((consultation: any) => {
      // üîπ ÏÉÅÎã¥ IDÏóê Ìï¥ÎãπÌïòÎäî Ïó∞ÎùΩÏ≤ò Ï†ïÎ≥¥ Ï∞æÍ∏∞
      const contactRelation = contactsConsultations.find(
        (cc: any) => cc.consultation_id === consultation.id
      );

      // üîπ `Partial<Contact>`Î°ú Îπà Í∞ùÏ≤¥Ïùò ÌÉÄÏûÖ ÏßÄÏ†ï
      const firstContact: any = contactRelation?.contacts || {};

      // üîπ Î¨∏ÏÑú Î≥ÄÌôò Î°úÏßÅ
      const documentTypes = {
        estimate: false,
        order: false,
        requestQuote: false,
      };

      consultation.documents?.forEach((doc: { type: string }) => {
        if (doc.type === "estimate") documentTypes.estimate = true;
        if (doc.type === "order") documentTypes.order = true;
        if (doc.type === "requestQuote") documentTypes.requestQuote = true;
      });

      return {
        ...consultation,
        contact_name: firstContact.contact_name || "",
        contact_level: firstContact.level || "",
        contact_email: firstContact.email || "",
        contact_mobile: firstContact.mobile || "",
        documents: documentTypes, // üîπ Î≥ÄÌôòÎêú documents Ï†ÅÏö©
      };
    });
  }, [consultations, contactsConsultations]);

  const handleAddConsultation = async () => {
    if (isAdding) return;

    const { content, follow_up_date, user_id, contact_name } = newConsultation;

    if (!content) {
      setSnackbarMessage("ÏÉÅÎã¥ ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.");
      return;
    }

    if (!contact_name) {
      setSnackbarMessage("Îã¥ÎãπÏûêÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.");
      return;
    }

    const formattedFollowUpDate = follow_up_date ? follow_up_date : null;

    try {
      setSaving(true);

      const addedConsultation = await addConsultation({
        method: "POST",
        body: {
          date: new Date().toISOString().split("T")[0],
          company_id: id as string,
          content,
          follow_up_date: formattedFollowUpDate,
          user_id,
        },
      });

      if (!addedConsultation?.consultation_id) {
        throw new Error("ÏÉÅÎã¥ Ï∂îÍ∞Ä Ïã§Ìå®");
      }

      // üîπ Îã¥ÎãπÏûê Ï∞æÍ∏∞
      const selectedContact = contacts.find(
        (c: Contact) => c.contact_name === contact_name
      );

      if (!selectedContact) {
        throw new Error("Îã¥ÎãπÏûê Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.");
      }

      // üîπ ÏÉÅÎã¥-Îã¥ÎãπÏûê Ïó∞Í≤∞
      await assignConsultationContact({
        method: "POST",
        body: {
          consultation_id: addedConsultation.consultation_id,
          contact_id: selectedContact.id,
          user_id,
        },
      });

      setSnackbarMessage("ÏÉÅÎã¥ ÎÇ¥Ïó≠ Ï∂îÍ∞Ä ÏôÑÎ£å");
      setOpenAddModal(false);
      await refreshConsultations();
      await refreshContactsConsultations();
    } catch (error) {
      setSnackbarMessage("ÏÉÅÎã¥ ÎÇ¥Ïó≠ Ï∂îÍ∞Ä Ï§ë Ïò§Î•ò Î∞úÏÉù");
    } finally {
      setSaving(false);
    }
  };

  const handleEditConsultation = (consultation: Consultation) => {
    setSelectedConsultation(consultation);
    setNewConsultation({
      date: consultation.date,
      follow_up_date: consultation.follow_up_date,
      user_id: consultation.user_id,
      content: consultation.content,
      contact_name: consultation.contact_name,
    });
    setOpenEditModal(true);
  };

  const handleUpdateConsultation = async () => {
    if (isUpdating) return;

    const { content, follow_up_date, user_id, contact_name } = newConsultation;

    if (!content || !user_id || !contact_name) {
      setSnackbarMessage("ÌïÑÏàò Ìï≠Î™©ÏùÑ Î™®Îëê ÏûÖÎ†•ÌïòÏÑ∏Ïöî.");
      return;
    }

    const selectedContact = contacts.find(
      (c: Contact) => c.contact_name === contact_name
    );

    if (!selectedContact) {
      setSnackbarMessage("Îã¥ÎãπÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.");
      return;
    }

    try {
      setSaving(true);

      // ‚úÖ SWR Mutation Ìò∏Ï∂ú
      await updateConsultation({
        method: "PATCH",
        body: {
          consultation_id: selectedConsultation?.id,
          content,
          follow_up_date,
          user_id,
          contact_id: selectedContact.id,
        },
      });

      setSnackbarMessage("ÏÉÅÎã¥ ÎÇ¥Ïó≠ ÏàòÏ†ï ÏôÑÎ£å");
      setOpenEditModal(false);
      await refreshConsultations();
      await refreshContactsConsultations();
    } catch (error) {
      setSnackbarMessage("ÏÉÅÎã¥ ÎÇ¥Ïó≠ ÏàòÏ†ï Ï§ë Ïò§Î•ò Î∞úÏÉù");
    } finally {
      setSaving(false);
    }
  };

  const handleDeleteConsultation = async (consultation: Consultation) => {
    setConsultationToDelete(consultation);
    setOpenDeleteModal(true);
  };

  const handleConfirmDelete = async () => {
    if (!consultationToDelete) return;

    try {
      const { error } = await supabase.from("deletion_requests").insert([
        {
          related_id: consultationToDelete.id,
          status: "pending",
          type: "consultation",
        },
      ]);

      if (error) {
        setSnackbarMessage("ÏÇ≠Ï†ú ÏöîÏ≤≠ÏùÑ ÏÉùÏÑ±ÌïòÎäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.");
      } else {
        setSnackbarMessage("ÏÇ≠Ï†ú ÏöîÏ≤≠Ïù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.");

        setOpenDeleteModal(false);
      }
    } catch (error) {
      setSnackbarMessage("ÏÇ≠Ï†ú ÏöîÏ≤≠ ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.");
    }
  };

  const prevPage = () => {
    if (currentPage > 1) {
      setCurrentPage(currentPage - 1);
    }
  };

  const nextPage = () => {
    if (currentPage < totalPages) {
      setCurrentPage(currentPage + 1);
    }
  };

  const handlePageClick = (page: number) => {
    setCurrentPage(page);
    router.push(`/consultations/${id}?page=${page}`, { scroll: false });
  };

  const paginationNumbers = () => {
    let pageNumbers = [];
    for (let i = 1; i <= totalPages; i++) {
      if (
        i === 1 ||
        i === totalPages ||
        (i >= currentPage - 2 && i <= currentPage + 2)
      ) {
        pageNumbers.push(i);
      } else if (i === currentPage - 3 || i === currentPage + 3) {
        pageNumbers.push("...");
      }
    }
    return pageNumbers;
  };

  const formatContentWithLineBreaks = (content: string) => {
    return content.split("\n").map((line, index) => (
      <span key={index}>
        {line}
        <br />
      </span>
    ));
  };

  const handleAddFavorite = async () => {
    try {
      await addFavorite(loginUser?.id, id, companyDetail?.name);
      await refetchFavorites();

      setSnackbarMessage("Ï¶êÍ≤®Ï∞æÍ∏∞Ïóê Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.");
    } catch (error) {
      console.error("Error fetching performance data:", error);
    }
  };

  const handleRemoveFavorite = async (id: string) => {
    try {
      await removeFavorite(id);
      await refetchFavorites();
      setSnackbarMessage("Ï¶êÍ≤®Ï∞æÍ∏∞Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.");
    } catch (error) {
      console.error("Error removing favorite:", error);
    }
  };

  useEffect(() => {
    // üîπ Ï≤´ Î≤àÏß∏ Îã¥ÎãπÏûêÎ•º Ï∞æÍ≥†, ÏóÜÏúºÎ©¥ Ïú†ÏßÄ
    const defaultContactName =
      contacts.length > 0
        ? contacts[0].contact_name
        : newConsultation.contact_name;
    const defaultUserId = loginUser?.id ?? newConsultation.user_id;

    // üîπ ÏÉÅÌÉú Î≥ÄÍ≤ΩÏù¥ ÌïÑÏöîÌï† ÎïåÎßå Ïã§Ìñâ
    if (
      newConsultation.contact_name !== defaultContactName ||
      newConsultation.user_id !== defaultUserId
    ) {
      setNewConsultation((prev) => ({
        ...prev,
        contact_name: defaultContactName,
        user_id: defaultUserId,
      }));
    }
  }, [contacts, loginUser]);

  useEffect(() => {
    // üîπ URLÏóêÏÑú page Í∞íÏùÑ ÏùΩÏñ¥ÏÑú ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
    const pageParam = searchParams.get("page");
    if (pageParam) {
      setCurrentPage(Number(pageParam));
    }
  }, [searchParams]);

  useEffect(() => {
    const handleKeyDown = (event: KeyboardEvent) => {
      if (event.key === "Escape") {
        setOpenAddModal(false);
        setOpenEditModal(false);
        setOpenDeleteModal(false);
      }
    };

    window.addEventListener("keydown", handleKeyDown);

    return () => {
      window.removeEventListener("keydown", handleKeyDown);
    };
  }, []);

  return (
    <div className="text-sm text-[#37352F]">
      <>
        <div className="mb-4">
          <Link
            href="/customers"
            className="text-blue-500 hover:underline hover:font-bold"
          >
            Í±∞ÎûòÏ≤ò Í¥ÄÎ¶¨
          </Link>{" "}
          &gt; <span className="font-semibold">{companyDetail?.name}</span> &gt;
          ÏÉÅÎã¥ÎÇ¥Ïó≠
        </div>

        {/* üöÄ Í±∞ÎûòÏ≤ò Í∏∞Î≥∏ Ï†ïÎ≥¥ */}

        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div className="bg-[#FBFBFB] rounded-md border px-4 pt-3  h-40 flex flex-col justify-between">
            {isCompanyDetailLoading ? (
              <>
                <Skeleton variant="text" width="100%" height="100%" />
              </>
            ) : (
              <div>
                <h2 className="font-semibold text-md mb-1">Í±∞ÎûòÏ≤ò</h2>
                <ul className="space-y-1 text-gray-700 text-sm pl-1">
                  <li className="flex items-center">
                    <span className="font-medium w-14">ÌöåÏÇ¨Î™Ö</span>
                    <span className="flex-1 truncate">
                      {companyDetail?.name}
                    </span>
                  </li>
                  <li className="flex items-center">
                    <span className="font-medium w-14">Ï£ºÏÜå</span>
                    <span className="flex-1 truncate">
                      {companyDetail?.address || "Ï†ïÎ≥¥ ÏóÜÏùå"}
                    </span>
                  </li>
                  <li className="flex items-center">
                    <span className="font-medium w-14">Ï†ÑÌôî</span>
                    <span className="flex-1">
                      {companyDetail?.phone || "Ï†ïÎ≥¥ ÏóÜÏùå"}
                    </span>
                  </li>
                  <li className="flex items-center">
                    <span className="font-medium w-14">Ìå©Ïä§</span>
                    <span className="flex-1">
                      {companyDetail?.fax || "Ï†ïÎ≥¥ ÏóÜÏùå"}
                    </span>
                  </li>
                  <li className="flex items-center">
                    <span className="font-medium w-14">Ïù¥Î©îÏùº</span>
                    <span className="flex-1 truncate">
                      {companyDetail?.email || "Ï†ïÎ≥¥ ÏóÜÏùå"}
                    </span>
                  </li>
                </ul>
              </div>
            )}
          </div>

          <div className="bg-[#FBFBFB] rounded-md border px-4 pt-3 h-40 flex flex-col">
            {isCompanyDetailLoading ? (
              <>
                <Skeleton variant="text" width="100%" height="100%" />
              </>
            ) : (
              <>
                <h2 className="font-semibold text-md mb-1">Îã¥ÎãπÏûê</h2>

                <div className=" h-28 overflow-y-auto">
                  <table className="w-full text-xs border-collapse">
                    <thead className="border-b font-semibold bg-gray-100 sticky top-0"></thead>
                    <tbody className="text-sm">
                      {contacts?.map((contact: any, index: any) => (
                        <tr
                          key={index}
                          className={`${
                            index !== contacts.length - 1 ? "border-b" : ""
                          }`}
                        >
                          <td className="px-1 py-1">{contact.contact_name}</td>
                          <td className="px-1 py-1">{contact.level}</td>
                          <td className="px-1 py-1">{contact.department}</td>
                          <td className="px-1 py-1">{contact.mobile}</td>
                          <td className="px-1 py-1 truncate">
                            {contact.email}
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </>
            )}
          </div>

          <div className="bg-[#FBFBFB] rounded-md border pl-4 pt-3">
            {isCompanyDetailLoading ? (
              <Skeleton variant="rectangular" width="100%" height="100%" />
            ) : (
              <>
                <h2 className="font-semibold text-md mb-1">ÎπÑÍ≥†</h2>
                <div className="text-sm min-h-[80px] max-h-28 overflow-y-auto pl-1">
                  <span>{companyDetail?.notes || "ÎÇ¥Ïö© ÏóÜÏùå"}</span>
                </div>
              </>
            )}
          </div>
        </div>

        {/* üöÄ Ï∂îÍ∞Ä Î≤ÑÌäº */}

        <div className="flex my-3 gap-4">
          {favorites.find((fav: any) => fav.name === companyDetail?.name) ? (
            <div
              className="px-4 py-2 font-semibold cursor-pointer hover:bg-opacity-10 hover:bg-black hover:rounded-md"
              onClick={() => {
                if (companyDetail?.id) {
                  handleRemoveFavorite(companyDetail.id);
                }
              }}
            >
              <span className="mr-2">-</span>
              <span>Ï¶êÍ≤®Ï∞æÍ∏∞ ÏÇ≠Ï†ú</span>
            </div>
          ) : (
            <div
              className="px-4 py-2 font-semibold cursor-pointer hover:bg-opacity-10 hover:bg-black hover:rounded-md"
              onClick={() => handleAddFavorite()}
            >
              <span className="mr-2">+</span>
              <span>Ï¶êÍ≤®Ï∞æÍ∏∞ Ï∂îÍ∞Ä</span>
            </div>
          )}
          <div
            className="px-4 py-2 font-semibold cursor-pointer hover:bg-opacity-10 hover:bg-black hover:rounded-md"
            onClick={() => setOpenAddModal(true)}
          >
            <span className="mr-2">+</span>
            <span>ÏÉÅÎã¥ Ï∂îÍ∞Ä</span>
          </div>
        </div>

        {/* ÏÉÅÎã¥ ÎÇ¥Ïó≠ Ï∂îÍ∞Ä Î™®Îã¨ */}
        {openAddModal && (
          <div className="fixed inset-0 flex justify-center items-center bg-gray-500 bg-opacity-50 z-50">
            <div className="bg-white p-6 rounded-md w-1/2 ">
              <h3 className="text-xl font-semibold mb-4">ÏÉÅÎã¥ ÎÇ¥Ïó≠ Ï∂îÍ∞Ä</h3>

              {/* ÏÉÅÎã¥Ïùº Î∞è ÌõÑÏÜç ÎÇ†Ïßú (flexÎ°ú Î∞∞Ïπò) */}
              <div className="mb-4 grid space-x-4 grid-cols-4">
                <div className="">
                  <label className="block mb-2 text-sm font-medium">
                    ÏÉÅÎã¥Ïùº
                  </label>
                  <input
                    type="date"
                    value={newConsultation.date}
                    readOnly
                    className="w-full p-2 border border-gray-300 rounded-md text-sm"
                  />
                </div>
                <div>
                  <label className="block mb-2 text-sm font-medium">
                    ÌõÑÏÜç ÎÇ†Ïßú
                  </label>
                  <input
                    type="date"
                    value={newConsultation.follow_up_date}
                    onChange={(e) =>
                      setNewConsultation({
                        ...newConsultation,
                        follow_up_date: e.target.value,
                      })
                    }
                    className="w-full p-2 border border-gray-300 rounded-md text-sm"
                  />
                </div>
                <div>
                  <label className="block mb-2 text-sm font-medium">
                    Í≥†Í∞ùÎ™Ö
                  </label>
                  <select
                    defaultValue={newConsultation.contact_name}
                    onChange={(e) =>
                      setNewConsultation({
                        ...newConsultation,
                        contact_name: e.target.value,
                      })
                    }
                    className="w-full p-2 border border-gray-300 rounded-md text-sm"
                  >
                    <option value="">Îã¥ÎãπÏûê ÏÑ†ÌÉù</option>
                    {contacts.map((contact: any) => (
                      <option key={contact.id} value={contact.contact_name}>
                        {contact.contact_name} ({contact.level})
                      </option>
                    ))}
                  </select>
                </div>
                <div>
                  <label className="block mb-2 text-sm font-medium">
                    ÏÉÅÎã¥Ïûê
                  </label>
                  <select
                    value={newConsultation.user_id}
                    disabled
                    onChange={(e) =>
                      setNewConsultation({
                        ...newConsultation,
                        user_id: e.target.value,
                      })
                    }
                    className="w-full p-2 border border-gray-300 rounded-md text-sm"
                  >
                    {/* Îã§Î•∏ Ïú†Ï†ÄÎì§ */}
                    {users.map((user: any) => (
                      <option key={user.id} value={user.id}>
                        {user.name} {user.level}
                      </option>
                    ))}
                  </select>
                </div>
              </div>

              {/* ÏÉÅÎã¥ ÎÇ¥Ïö© */}
              <div className="mb-4">
                <label className="block mb-2 text-sm font-medium">
                  ÏÉÅÎã¥ ÎÇ¥Ïö©
                </label>
                <textarea
                  value={newConsultation.content}
                  onChange={(e) =>
                    setNewConsultation({
                      ...newConsultation,
                      content: e.target.value,
                    })
                  }
                  className="w-full p-2 border border-gray-300 rounded-md text-sm"
                  rows={4}
                />
              </div>

              {/* Î≤ÑÌäº */}
              <div className="flex justify-end space-x-2">
                <button
                  onClick={() => {
                    setOpenAddModal(false);
                    setNewConsultation({
                      date: new Date().toISOString().split("T")[0],
                      follow_up_date: "",
                      user_id: loginUser ? loginUser.id : "",
                      content: "",
                      contact_name: "",
                    });
                  }}
                  className={`bg-gray-500 text-white px-4 py-2 rounded-md text-xs md:text-sm ${
                    saving ? "opacity-50 cursor-not-allowed" : ""
                  }`}
                  disabled={saving}
                >
                  Ï∑®ÏÜå
                </button>

                <button
                  onClick={handleAddConsultation}
                  className={`bg-blue-500 text-white px-4 py-2 rounded-md text-xs md:text-sm flex items-center ${
                    saving ? "opacity-50 cursor-not-allowed" : ""
                  }`}
                  disabled={saving}
                >
                  Ï†ÄÏû•
                  {saving && <CircularProgress size={18} className="ml-2" />}
                </button>
              </div>
            </div>
          </div>
        )}

        {/* ÏÉÅÎã¥ ÎÇ¥Ïó≠ ÏàòÏ†ï Î™®Îã¨ */}
        {openEditModal && (
          <div className="fixed inset-0 flex justify-center items-center bg-gray-500 bg-opacity-50 z-50">
            <div className="bg-white p-6 rounded-md w-1/2">
              <h3 className="text-xl font-semibold mb-4">ÏÉÅÎã¥ ÎÇ¥Ïó≠ ÏàòÏ†ï</h3>

              {/* ÏÉÅÎã¥Ïùº Î∞è ÌõÑÏÜç ÎÇ†Ïßú (flexÎ°ú Î∞∞Ïπò) */}
              <div className="mb-4 grid grid-cols-4 space-x-4">
                <div>
                  <label className="block mb-2 text-sm font-medium">
                    ÏÉÅÎã¥Ïùº
                  </label>
                  <input
                    type="date"
                    value={newConsultation.date}
                    readOnly
                    className="w-full p-2 border border-gray-300 rounded-md text-sm"
                  />
                </div>
                <div>
                  <label className="block mb-2 text-sm font-medium">
                    ÌõÑÏÜç ÎÇ†Ïßú
                  </label>
                  <input
                    type="date"
                    value={
                      newConsultation.follow_up_date
                        ? newConsultation.follow_up_date
                        : ""
                    }
                    onChange={(e) =>
                      setNewConsultation({
                        ...newConsultation,
                        follow_up_date: e.target.value,
                      })
                    }
                    className="w-full p-2 border border-gray-300 rounded-md text-sm"
                  />
                </div>
                <div>
                  <label className="block mb-2 text-sm font-medium">
                    Í≥†Í∞ùÎ™Ö
                  </label>
                  <select
                    defaultValue={newConsultation.contact_name}
                    onChange={(e) =>
                      setNewConsultation({
                        ...newConsultation,
                        contact_name: e.target.value,
                      })
                    }
                    className="w-full p-2 border border-gray-300 rounded-md text-sm"
                  >
                    <option value="">Îã¥ÎãπÏûê ÏÑ†ÌÉù</option>
                    {contacts.map((contact: any) => (
                      <option key={contact.id} value={contact.contact_name}>
                        {contact.contact_name} ({contact.level})
                      </option>
                    ))}
                  </select>
                </div>
                <div>
                  <label className="block mb-2 text-sm font-medium">
                    ÏÉÅÎã¥Ïûê
                  </label>

                  <select
                    value={newConsultation.user_id}
                    disabled
                    onChange={(e) =>
                      setNewConsultation({
                        ...newConsultation,
                        user_id: e.target.value,
                      })
                    }
                    className="w-full p-2 border border-gray-300 rounded-md text-sm"
                  >
                    {users.map((user: any) => (
                      <option key={user.id} value={user.id}>
                        {user.name} {user.level}
                      </option>
                    ))}
                  </select>
                </div>
              </div>

              {/* ÏÉÅÎã¥ ÎÇ¥Ïö© */}
              <div className="mb-4">
                <label className="block mb-2 text-sm font-medium">
                  ÏÉÅÎã¥ ÎÇ¥Ïö©
                </label>
                <textarea
                  value={newConsultation.content}
                  onChange={(e) =>
                    setNewConsultation({
                      ...newConsultation,
                      content: e.target.value,
                    })
                  }
                  className="w-full p-2 border border-gray-300 rounded-md text-sm"
                  rows={4}
                />
              </div>

              {/* Î≤ÑÌäº */}
              <div className="flex justify-end space-x-2">
                <button
                  onClick={() => {
                    setOpenEditModal(false);
                    setNewConsultation({
                      date: new Date().toISOString().split("T")[0],
                      follow_up_date: "",
                      user_id: "",
                      content: "",
                      contact_name: "",
                    });
                  }}
                  className={`bg-gray-500 text-white px-4 py-2 rounded-md text-xs md:text-sm ${
                    saving ? "opacity-50 cursor-not-allowed" : ""
                  }`}
                  disabled={saving}
                >
                  Ï∑®ÏÜå
                </button>

                <button
                  onClick={handleUpdateConsultation}
                  className={`bg-blue-500 text-white px-4 py-2 rounded-md text-xs md:text-sm flex items-center ${
                    saving ? "opacity-50 cursor-not-allowed" : ""
                  }`}
                  disabled={saving}
                >
                  Ï†ÄÏû•
                  {saving && <CircularProgress size={18} className="ml-2" />}
                </button>
              </div>
            </div>
          </div>
        )}

        {/* ÏÉÅÎã¥ ÎÇ¥Ïó≠ ÌÖåÏù¥Î∏î */}
        <div className="bg-[#FBFBFB] rounded-md border">
          {consultations.length > 0 && (
            <table className="min-w-full table-auto border-collapse text-center">
              <thead>
                <tr className="bg-gray-100 text-left">
                  <th className="px-4 py-2 border-b border-r-[1px] text-center">
                    No.
                  </th>
                  <th className="px-4 py-2 border-b border-r-[1px] text-center">
                    ÎÇ†Ïßú
                  </th>
                  <th className="px-4 py-2 border-b border-r-[1px] text-center w-1/12">
                    ÌîºÏÉÅÎã¥Ïûê
                  </th>
                  <th className="px-4 py-2 border-b border-r-[1px] text-center w-1/12">
                    ÏÉÅÎã¥Ïûê
                  </th>
                  <th className="px-4 py-2 border-b border-r-[1px] text-center w-5/12">
                    ÎÇ¥Ïö©
                  </th>
                  <th className="px-4 py-2 border-b border-r-[1px] text-center">
                    Ï≤¥ÌÅ¨
                  </th>
                  <th className="px-4 py-2 border-b border-r-[1px] text-center">
                    Î¨∏ÏÑú
                  </th>
                  <th className="px-4 py-2 border-b border-r-[1px] text-center">
                    ÏàòÏ†ï
                  </th>
                  <th className="px-4 py-2 border-b border-r-[1px] text-center">
                    ÏÇ≠Ï†ú
                  </th>
                </tr>
              </thead>
              <tbody>
                {processedConsultations.map((consultation: any, index: any) => (
                  <tr
                    key={consultation.id}
                    className="hover:bg-gray-100 border-b"
                  >
                    <td className="px-4 py-2 border-r-[1px]">
                      {consultation.id.slice(0, 4)}
                    </td>
                    <td className="px-4 py-2 border-r-[1px]">
                      {consultation.date}
                    </td>
                    <td className="px-4 py-2 border-r-[1px]">
                      {consultation.contact_name} {consultation.contact_level}
                    </td>
                    <td className="px-4 py-2 border-r-[1px]">
                      {
                        users.find(
                          (user: any) => user.id === consultation.user_id
                        )?.name
                      }{" "}
                      {
                        users.find(
                          (user: any) => user.id === consultation.user_id
                        )?.level
                      }
                    </td>
                    <td
                      className="px-4 py-2 border-r-[1px] w-full text-start"
                      style={{
                        minHeight: "120px",
                        maxHeight: "120px",
                        overflowY: "auto",
                        display: "block",
                      }}
                    >
                      {formatContentWithLineBreaks(consultation.content)}
                    </td>
                    <td className="px-4 py-2 border-r-[1px]">
                      {consultation.follow_up_date}
                    </td>
                    <td className="px-4 py-2 border-r-[1px]">
                      <span
                        className={`mr-2 cursor-pointer ${
                          consultation.documents.estimate
                            ? "text-blue-500 hover:font-bold"
                            : "text-gray-400 hover:text-black"
                        }`}
                        onClick={() =>
                          router.push(
                            `/documents/estimate?consultId=${consultation.id}&compId=${companyDetail?.id}`
                          )
                        }
                      >
                        Í≤¨Ï†ÅÏÑú
                      </span>
                      <span
                        className={`mr-2 cursor-pointer ${
                          consultation.documents.order
                            ? "text-blue-500 hover:font-bold"
                            : "text-gray-400 hover:text-black"
                        }`}
                        onClick={() =>
                          router.push(
                            `/documents/order?consultId=${consultation.id}&compId=${companyDetail?.id}`
                          )
                        }
                      >
                        Î∞úÏ£ºÏÑú
                      </span>
                      <span
                        className={`mr-2 cursor-pointer ${
                          consultation.documents.requestQuote
                            ? "text-blue-500 hover:font-bold"
                            : "text-gray-400 hover:text-black"
                        }`}
                        onClick={() =>
                          router.push(
                            `/documents/requestQuote?consultId=${consultation.id}&compId=${companyDetail?.id}`
                          )
                        }
                      >
                        ÏùòÎ¢∞ÏÑú
                      </span>
                    </td>
                    <td
                      className={`px-4 py-2 border-r-[1px] ${
                        loginUser?.id === consultation.user_id &&
                        "text-blue-500 cursor-pointer"
                      }`}
                      onClick={() => {
                        if (loginUser?.id === consultation.user_id)
                          handleEditConsultation(consultation);
                      }}
                    >
                      ÏàòÏ†ï
                    </td>
                    <td
                      className={`px-4 py-2 border-r-[1px] ${
                        loginUser?.id === consultation.user_id &&
                        "text-red-500 cursor-pointer"
                      }`}
                      onClick={() => {
                        if (loginUser?.id === consultation.user_id)
                          handleDeleteConsultation(consultation);
                      }}
                    >
                      ÏÇ≠Ï†ú
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          )}
        </div>

        {/* ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò */}
        <div className="flex justify-center mt-4 overflow-x-auto space-x-1 md:space-x-2">
          <div className="flex justify-center mt-4 space-x-2">
            <button
              onClick={prevPage}
              disabled={currentPage === 1}
              className="px-3 py-1 border rounded bg-white hover:bg-gray-100"
            >
              Ïù¥Ï†Ñ
            </button>

            {paginationNumbers().map((page, index) => (
              <button
                key={index}
                onClick={() => handlePageClick(Number(page))}
                className={`px-3 py-1 border rounded ${
                  currentPage === page
                    ? "bg-blue-500 text-white font-bold"
                    : "bg-gray-50 text-gray-600 hover:bg-gray-200"
                }`}
              >
                {page}
              </button>
            ))}

            <button
              onClick={nextPage}
              disabled={currentPage === totalPages}
              className="px-3 py-1 border rounded bg-white hover:bg-gray-100"
            >
              Îã§Ïùå
            </button>
          </div>
        </div>
      </>

      {openDeleteModal && consultationToDelete && (
        <div className="fixed inset-0 flex justify-center items-center bg-gray-500 bg-opacity-50 z-50">
          <div className="bg-white p-6 rounded-md w-1/3 max-w-lg">
            <h3 className="text-xl font-semibold mb-4">ÏÉÅÎã¥ ÎÇ¥Ïó≠ ÏÇ≠Ï†ú</h3>
            <p>
              Ï†ïÎßêÎ°ú "{consultationToDelete.content}"Ïùò ÏÉÅÎã¥ ÎÇ¥Ïó≠ÏùÑ
              ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?
            </p>

            <div className="flex justify-end space-x-4 mt-4">
              <button
                onClick={() => setOpenDeleteModal(false)}
                className="bg-gray-500 text-white px-4 py-2 rounded-md text-sm"
              >
                Ï∑®ÏÜå
              </button>
              <button
                onClick={handleConfirmDelete}
                className="bg-red-500 text-white px-4 py-2 rounded-md text-sm"
              >
                ÏÇ≠Ï†ú
              </button>
            </div>
          </div>
        </div>
      )}
      <SnackbarComponent
        message={snackbarMessage}
        onClose={() => setSnackbarMessage("")}
      />
    </div>
  );
}

// "use client";

// import { useState, useEffect, useMemo } from "react";
// import { useParams, useRouter, useSearchParams } from "next/navigation";
// import { supabase } from "@/lib/supabaseClient";
// import { Skeleton, CircularProgress } from "@mui/material";
// import Link from "next/link";
// import { useLoginUser } from "@/context/login";
// import { useFavorites } from "@/hooks/favorites/useFavorites";
// import SnackbarComponent from "@/components/Snackbar";

// interface Consultation {
//   id: string;
//   date: string;
//   content: string;
//   follow_up_date: any;
//   user_id: string;
//   contact_name: string;
//   contact_level: string;
//   documents: {
//     estimate: boolean;
//     order: boolean;
//     requestQuote: boolean;
//   };
// }
// interface Contact {
//   id: string;
//   contact_name: string;
//   mobile: string;
//   department: string;
//   level: string;
//   email: string;
// }

// interface Company {
//   id: string;
//   name: string;
//   address: string;
//   phone: string;
//   email: string;
//   fax: string;
//   notes: string;
//   business_number: string;
// }

// interface User {
//   id: string;
//   name: string;
//   level: string;
// }

// export default function ConsultationPage() {
//   const loginUser = useLoginUser();

//   const router = useRouter();
//   const { id } = useParams();
//   const searchParams = useSearchParams();

//   const { favorites, refetchFavorites } = useFavorites(loginUser?.id);

//   const [saving, setSaving] = useState(false);

//   const [consultations, setConsultations] = useState<Consultation[]>([]);
//   const [company, setCompany] = useState<Company | null>(null);

//   const [companyLoading, setCompanyLoading] = useState(false);
//   const [consultationLoading, setConsultationLoading] = useState(false);

//   const [openSnackbar, setOpenSnackbar] = useState(false);
//   const [snackbarMessage, setSnackbarMessage] = useState<string>("");
//   const [openAddModal, setOpenAddModal] = useState(false);
//   const [openEditModal, setOpenEditModal] = useState(false);
//   const [newConsultation, setNewConsultation] = useState({
//     date: new Date().toISOString().split("T")[0],
//     follow_up_date: "",
//     contact_name: "",
//     user_id: "",
//     content: "",
//   });

//   const [contacts, setContacts] = useState<Contact[]>([]);
//   const [users, setUsers] = useState<User[]>([]);
//   const [currentPage, setCurrentPage] = useState(1);
//   const [totalPages, setTotalPages] = useState(1);
//   const consultationsPerPage = 4;
//   const [selectedConsultation, setSelectedConsultation] =
//     useState<Consultation | null>(null);

//   const [openDeleteModal, setOpenDeleteModal] = useState(false);
//   const [consultationToDelete, setConsultationToDelete] =
//     useState<Consultation | null>(null);

//   function transformConsultationData(
//     consultations: any[],
//     contacts: Contact[],
//     contacts_consultations: { contact_id: string; consultation_id: string }[]
//   ) {
//     return consultations.map((consultation) => {
//       const contactRelation = contacts_consultations.find(
//         (cc) => cc.consultation_id === consultation.id
//       );

//       const firstContact =
//         contacts.find(
//           (contact) => contact.id === contactRelation?.contact_id
//         ) || ({} as Partial<Contact>);

//       const documentTypes = {
//         estimate: false,
//         order: false,
//         requestQuote: false,
//       };

//       consultation.documents.forEach((doc: any) => {
//         if (doc.type === "estimate") documentTypes.estimate = true;
//         if (doc.type === "order") documentTypes.order = true;
//         if (doc.type === "requestQuote") documentTypes.requestQuote = true;
//       });

//       return {
//         content: consultation.content,
//         date: consultation.date,
//         contact_name: firstContact.contact_name || "",
//         contact_level: firstContact.level || "",
//         contact_email: firstContact.email || "",
//         contact_mobile: firstContact.mobile || "",
//         documents: documentTypes,
//         follow_up_date: consultation.follow_up_date,
//         id: consultation.id,
//         user_id: consultation.user_id,
//       };
//     });
//   }

//   const fetchContactsData = async () => {
//     if (!id) return;

//     try {
//       const { data: contactsData, error: contactsError } = await supabase
//         .from("contacts")
//         .select("id, contact_name, mobile, department, level, email")
//         .eq("company_id", id);

//       if (contactsError) {
//         setSnackbarMessage("Îã¥ÎãπÏûêÎ•º Î∂àÎü¨Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.");

//       }
//       setContacts(contactsData || []);
//     } catch (error) {
//       console.error("Îã¥ÎãπÏûê Î°úÎî© Ï§ë Ïò§Î•ò Î∞úÏÉù:", error);
//       setSnackbarMessage(
//         "Îã¥ÎãπÏûê Í∞ÄÏ†∏Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.-fetchContactsData"
//       );

//     }
//   };

//   const fetchCompanyData = async () => {
//     if (!id) return;
//     setCompanyLoading(true);

//     try {
//       const { data: companyData, error: companyDataError } = await supabase
//         .from("companies")
//         .select("*")
//         .eq("id", id)
//         .single();

//       setCompany(companyData);

//       if (companyDataError) {
//         setSnackbarMessage("ÌöåÏÇ¨Î•º Î∂àÎü¨Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.");

//         return;
//       }
//     } catch (error) {
//       console.error("‚ùó ÌöåÏÇ¨Ï†ïÎ≥¥ Î°úÎî© Ï§ë Ïò§Î•ò Î∞úÏÉù:", error);
//       setSnackbarMessage(
//         "ÌöåÏÇ¨Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.-fetchCompanyData"
//       );

//     } finally {
//       setCompanyLoading(false);
//     }
//   };

//   const fetchConsultationData = async () => {
//     if (!id) return;

//     setConsultationLoading(true);

//     try {
//       const {
//         data: consultationsData,
//         error: consultationsError,
//         count,
//       } = await supabase
//         .from("consultations")
//         .select(
//           `id, date, content, follow_up_date, user_id,
//           documents (type)
//         `,
//           {
//             count: "exact",
//           }
//         )
//         .eq("company_id", id)
//         .range(
//           (currentPage - 1) * consultationsPerPage,
//           currentPage * consultationsPerPage - 1
//         )
//         .order("created_at", { ascending: false });

//       if (consultationsError) {
//         setSnackbarMessage("ÏÉÅÎã¥ ÎÇ¥Ïó≠ÏùÑ Î∂àÎü¨Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.");

//         return;
//       }

//       const filteredConsultId = consultationsData.map((con) => con.id);

//       const {
//         data: contactsConsultationData,
//         error: contactsConsultationDataError,
//       } = await supabase
//         .from("contacts_consultations")
//         .select("consultation_id, contact_id")
//         .in("consultation_id", filteredConsultId);

//       if (consultationsError) {
//         setSnackbarMessage("Î¨∏ÏÑú-Îã¥ÎãπÏûê Í¥ÄÍ≥ÑÎ•º Î∂àÎü¨Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.");

//         return;
//       }

//       setConsultations(
//         transformConsultationData(
//           consultationsData,
//           contacts,
//           contactsConsultationData ?? []
//         )
//       );

//       setTotalPages(count ? Math.ceil(count / consultationsPerPage) : 1);
//     } catch (error) {
//       console.error("fetchConsultationData Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë Ïò§Î•ò Î∞úÏÉù:", error);

//       setSnackbarMessage(
//         "Îç∞Ïù¥ÌÑ∞Î•º Í∞ÄÏ†∏Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.-fetchConsultationData"
//       );
//     } finally {
//       setConsultationLoading(false);
//     }
//   };

//   const fetchUsers = async () => {
//     const { data: usersData, error: usersError } = await supabase
//       .from("users")
//       .select("id, name,level");

//     if (usersError) {
//       setSnackbarMessage("Ïú†Ï†Ä Î™©Î°ùÏùÑ Î∂àÎü¨Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.");

//     } else {
//       setUsers(usersData || []);
//     }
//   };

//   useEffect(() => {
//     // üîπ URLÏóêÏÑú page Í∞íÏùÑ ÏùΩÏñ¥ÏÑú ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
//     const pageParam = searchParams.get("page");
//     if (pageParam) {
//       setCurrentPage(Number(pageParam));
//     }
//   }, [searchParams]);

//   useEffect(() => {
//     fetchCompanyData();
//     fetchUsers();
//     fetchContactsData();

//     const handleKeyDown = (event: KeyboardEvent) => {
//       if (event.key === "Escape") {
//         setOpenAddModal(false);
//         setOpenEditModal(false);
//         setOpenDeleteModal(false);
//       }
//     };

//     window.addEventListener("keydown", handleKeyDown);

//     return () => {
//       window.removeEventListener("keydown", handleKeyDown);
//     };
//   }, []);

//   useEffect(() => {
//     if (contacts.length !== 0) fetchConsultationData();
//   }, [contacts, currentPage]);

//   useEffect(() => {
//     if (contacts.length > 0) {
//       setNewConsultation((prev) => ({
//         ...prev,
//         contact_name: contacts[0].contact_name,
//       }));
//     }

//     if (loginUser?.id) {
//       setNewConsultation((prev) => ({
//         ...prev,
//         user_id: loginUser.id,
//       }));
//     }
//   }, [contacts, loginUser]);

//   const handleAddConsultation = async () => {
//     if (saving) return;
//     setSaving(true);

//     const { content, follow_up_date, user_id, contact_name } = newConsultation;
//     const formattedFollowUpDate = follow_up_date ? follow_up_date : null;

//     if (!content) {
//       setSnackbarMessage("ÏÉÅÎã¥ ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.");

//       setSaving(false);
//       return;
//     }

//     if (!contact_name) {
//       setSnackbarMessage("Îã¥ÎãπÏûêÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.");

//       setSaving(false);
//       return;
//     }

//     try {
//       const { data: insertedConsultation, error: insertError } = await supabase
//         .from("consultations")
//         .insert([
//           {
//             date: new Date().toISOString().split("T")[0],
//             company_id: id,
//             content,
//             follow_up_date: formattedFollowUpDate,
//             user_id,
//           },
//         ])
//         .select("id")
//         .single();

//       if (insertError || !insertedConsultation) {
//         throw new Error("ÏÉÅÎã¥ ÎÇ¥Ïó≠ Ï∂îÍ∞Ä Ïã§Ìå®");
//       }

//       const consultationId = insertedConsultation.id;

//       const selectedContact = contacts.find(
//         (c) => c.contact_name === contact_name
//       );

//       if (!selectedContact) throw new Error("Îã¥ÎãπÏûê Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.");

//       await supabase.from("contacts_consultations").insert([
//         {
//           contact_id: selectedContact.id,
//           consultation_id: consultationId,
//           user_id: user_id,
//         },
//       ]);

//       setSnackbarMessage("ÏÉÅÎã¥ ÎÇ¥Ïó≠ Ï∂îÍ∞Ä ÏôÑÎ£å");

//       setOpenAddModal(false);
//       fetchConsultationData();
//     } catch (error) {
//       console.error("Error adding consultation:", error);
//       setSnackbarMessage("ÏÉÅÎã¥ ÎÇ¥Ïó≠ Ï∂îÍ∞Ä Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.");

//     } finally {
//       setSaving(false);
//     }
//   };

//   const handleEditConsultation = (consultation: Consultation) => {
//     setSelectedConsultation(consultation);
//     setNewConsultation({
//       date: consultation.date,
//       follow_up_date: consultation.follow_up_date,
//       user_id: consultation.user_id,
//       content: consultation.content,
//       contact_name: consultation.contact_name,
//     });
//     setOpenEditModal(true);
//   };

//   const handleUpdateConsultation = async () => {
//     if (saving) return;
//     setSaving(true);

//     const { content, follow_up_date, user_id, contact_name } = newConsultation;

//     if (!content || !user_id || !contact_name) {
//       setSnackbarMessage("ÌïÑÏàò Ìï≠Î™©ÏùÑ Î™®Îëê ÏûÖÎ†•ÌïòÏÑ∏Ïöî.");

//       setSaving(false);
//       return;
//     }

//     try {
//       const selectedContact = contacts.find(
//         (c) => c.contact_name === contact_name
//       );

//       const { error } = await supabase
//         .from("contacts_consultations")
//         .update({
//           contact_id: selectedContact?.id,
//           // user_id ÎßåÏïΩ ÏÉÅÎã¥Ïûê Î≥ÄÍ≤Ω Í∏∞Îä•ÏùÑ ÎßåÎì§Ïñ¥ÏïºÌïúÎã§Î©¥
//         })
//         .eq("consultation_id", selectedConsultation?.id);

//       if (error) {
//         throw new Error("ÏÉàÎ°úÏö¥ Îã¥ÎãπÏûê ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®");
//       }

//       const { error: updateError } = await supabase
//         .from("consultations")
//         .update({
//           content,
//           follow_up_date,
//           user_id,
//         })
//         .eq("id", selectedConsultation?.id);

//       if (updateError) {
//         throw new Error("ÏÉÅÎã¥ ÎÇ¥Ïó≠ ÏàòÏ†ï Ïã§Ìå®");
//       }

//       setSnackbarMessage("ÏÉÅÎã¥ ÎÇ¥Ïó≠ ÏàòÏ†ï ÏôÑÎ£å");

//       setOpenEditModal(false);

//       fetchConsultationData();
//     } catch (error) {
//       console.error("Error updating consultation:", error);
//       setSnackbarMessage("ÏÉÅÎã¥ ÎÇ¥Ïó≠ ÏàòÏ†ï Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.");

//     } finally {
//       setSaving(false);
//     }
//   };

//   const prevPage = () => {
//     if (currentPage > 1) {
//       setCurrentPage(currentPage - 1);
//     }
//   };

//   const nextPage = () => {
//     if (currentPage < totalPages) {
//       setCurrentPage(currentPage + 1);
//     }
//   };

//   const handlePageClick = (page: number) => {
//     setCurrentPage(page);
//     router.push(`/consultations/${id}?page=${page}`, { scroll: false });
//   };

//   const paginationNumbers = () => {
//     let pageNumbers = [];
//     for (let i = 1; i <= totalPages; i++) {
//       if (
//         i === 1 ||
//         i === totalPages ||
//         (i >= currentPage - 2 && i <= currentPage + 2)
//       ) {
//         pageNumbers.push(i);
//       } else if (i === currentPage - 3 || i === currentPage + 3) {
//         pageNumbers.push("...");
//       }
//     }
//     return pageNumbers;
//   };

//   const companyMemo = useMemo(() => company, [company]);

//   const handleDeleteConsultation = async (consultation: Consultation) => {
//     setConsultationToDelete(consultation);
//     setOpenDeleteModal(true);
//   };

//   const addFavorite = async () => {
//     try {
//       const res = await fetch(
//         `/api/tests/favorite?userId=${loginUser?.id}&type=company&name=${company?.name}&itemId=${id}`,
//         { method: "POST" }
//       );

//       await refetchFavorites();

//       setSnackbarMessage("Ï¶êÍ≤®Ï∞æÍ∏∞Ïóê Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.");
//     } catch (error) {
//       console.error("Error fetching performance data:", error);
//     }
//   };

//   const removeFavorite = async (id: string) => {
//     try {
//       const res = await fetch(
//         `/api/tests/favorite?userId=${loginUser?.id}&companyId=${id}`,
//         {
//           method: "DELETE",
//         }
//       );

//       if (!res.ok) {
//         console.error("Failed to remove favorite");
//         return;
//       }

//       // ‚úÖ ÏÑúÎ≤ÑÏóêÏÑú ÏµúÏã† Îç∞Ïù¥ÌÑ∞Î•º Í∞ïÏ†úÎ°ú Îã§Ïãú Î∂àÎü¨Ïò§Í∏∞
//       await refetchFavorites();
//       setSnackbarMessage("Ï¶êÍ≤®Ï∞æÍ∏∞Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.");
//     } catch (error) {
//       console.error("Error removing favorite:", error);
//     }
//   };

//   const handleConfirmDelete = async () => {
//     if (!consultationToDelete) return;

//     try {
//       const { error } = await supabase.from("deletion_requests").insert([
//         {
//           related_id: consultationToDelete.id,
//           status: "pending",
//           type: "consultation",
//         },
//       ]);

//       if (error) {
//         setSnackbarMessage("ÏÇ≠Ï†ú ÏöîÏ≤≠ÏùÑ ÏÉùÏÑ±ÌïòÎäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.");

//       } else {
//         setSnackbarMessage("ÏÇ≠Ï†ú ÏöîÏ≤≠Ïù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.");

//         setOpenDeleteModal(false);
//         fetchConsultationData();
//       }
//     } catch (error) {
//       setSnackbarMessage("ÏÇ≠Ï†ú ÏöîÏ≤≠ ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.");

//     }
//   };

//   const formatContentWithLineBreaks = (content: string) => {
//     return content.split("\n").map((line, index) => (
//       <span key={index}>
//         {line}
//         <br />
//       </span>
//     ));
//   };

//   return (
//     <div className="text-sm text-[#37352F]">
//       <>
//         <div className="mb-4">
//           <Link
//             href="/customers"
//             className="text-blue-500 hover:underline hover:font-bold"
//           >
//             Í±∞ÎûòÏ≤ò Í¥ÄÎ¶¨
//           </Link>{" "}
//           &gt; <span className="font-semibold">{companyMemo?.name}</span> &gt;
//           ÏÉÅÎã¥ÎÇ¥Ïó≠
//         </div>

//         {/* üöÄ Í±∞ÎûòÏ≤ò Í∏∞Î≥∏ Ï†ïÎ≥¥ */}

//         <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
//           <div className="bg-[#FBFBFB] rounded-md border px-4 pt-3  h-40 flex flex-col justify-between">
//             {companyLoading ? (
//               <>
//                 <Skeleton variant="text" width="100%" height="100%" />
//               </>
//             ) : (
//               <div>
//                 <h2 className="font-semibold text-md mb-1">Í±∞ÎûòÏ≤ò</h2>
//                 <ul className="space-y-1 text-gray-700 text-sm pl-1">
//                   <li className="flex items-center">
//                     <span className="font-medium w-14">ÌöåÏÇ¨Î™Ö</span>
//                     <span className="flex-1 truncate">{companyMemo?.name}</span>
//                   </li>
//                   <li className="flex items-center">
//                     <span className="font-medium w-14">Ï£ºÏÜå</span>
//                     <span className="flex-1 truncate">
//                       {companyMemo?.address || "Ï†ïÎ≥¥ ÏóÜÏùå"}
//                     </span>
//                   </li>
//                   <li className="flex items-center">
//                     <span className="font-medium w-14">Ï†ÑÌôî</span>
//                     <span className="flex-1">
//                       {companyMemo?.phone || "Ï†ïÎ≥¥ ÏóÜÏùå"}
//                     </span>
//                   </li>
//                   <li className="flex items-center">
//                     <span className="font-medium w-14">Ìå©Ïä§</span>
//                     <span className="flex-1">
//                       {companyMemo?.fax || "Ï†ïÎ≥¥ ÏóÜÏùå"}
//                     </span>
//                   </li>
//                   <li className="flex items-center">
//                     <span className="font-medium w-14">Ïù¥Î©îÏùº</span>
//                     <span className="flex-1 truncate">
//                       {companyMemo?.email || "Ï†ïÎ≥¥ ÏóÜÏùå"}
//                     </span>
//                   </li>
//                 </ul>
//               </div>
//             )}
//           </div>

//           <div className="bg-[#FBFBFB] rounded-md border px-4 pt-3 h-40 flex flex-col">
//             {companyLoading ? (
//               <>
//                 <Skeleton variant="text" width="100%" height="100%" />
//               </>
//             ) : (
//               <>
//                 <h2 className="font-semibold text-md mb-1">Îã¥ÎãπÏûê</h2>

//                 <div className=" h-28 overflow-y-auto">
//                   <table className="w-full text-xs border-collapse">
//                     <thead className="border-b font-semibold bg-gray-100 sticky top-0"></thead>
//                     <tbody className="text-sm">
//                       {contacts?.map((contact, index) => (
//                         <tr
//                           key={index}
//                           className={`${
//                             index !== contacts.length - 1 ? "border-b" : ""
//                           }`}
//                         >
//                           <td className="px-1 py-1">{contact.contact_name}</td>
//                           <td className="px-1 py-1">{contact.level}</td>
//                           <td className="px-1 py-1">{contact.department}</td>
//                           <td className="px-1 py-1">{contact.mobile}</td>
//                           <td className="px-1 py-1 truncate">
//                             {contact.email}
//                           </td>
//                         </tr>
//                       ))}
//                     </tbody>
//                   </table>
//                 </div>
//               </>
//             )}
//           </div>

//           <div className="bg-[#FBFBFB] rounded-md border pl-4 pt-3">
//             {companyLoading ? (
//               <Skeleton variant="rectangular" width="100%" height="100%" />
//             ) : (
//               <>
//                 <h2 className="font-semibold text-md mb-1">ÎπÑÍ≥†</h2>
//                 <div className="text-sm min-h-[80px] max-h-28 overflow-y-auto pl-1">
//                   <span>{companyMemo?.notes || "ÎÇ¥Ïö© ÏóÜÏùå"}</span>
//                 </div>
//               </>
//             )}
//           </div>
//         </div>

//         {/* üöÄ Ï∂îÍ∞Ä Î≤ÑÌäº */}

//         <div className="flex my-3 gap-4">
//           {favorites.find((fav: any) => fav.name === company?.name) ? (
//             <div
//               className="px-4 py-2 font-semibold cursor-pointer hover:bg-opacity-10 hover:bg-black hover:rounded-md"
//               onClick={() => {
//                 if (company?.id) {
//                   removeFavorite(company.id);
//                 }
//               }}
//             >
//               <span className="mr-2">-</span>
//               <span>Ï¶êÍ≤®Ï∞æÍ∏∞ ÏÇ≠Ï†ú</span>
//             </div>
//           ) : (
//             <div
//               className="px-4 py-2 font-semibold cursor-pointer hover:bg-opacity-10 hover:bg-black hover:rounded-md"
//               onClick={() => addFavorite()}
//             >
//               <span className="mr-2">+</span>
//               <span>Ï¶êÍ≤®Ï∞æÍ∏∞ Ï∂îÍ∞Ä</span>
//             </div>
//           )}
//           <div
//             className="px-4 py-2 font-semibold cursor-pointer hover:bg-opacity-10 hover:bg-black hover:rounded-md"
//             onClick={() => setOpenAddModal(true)}
//           >
//             <span className="mr-2">+</span>
//             <span>ÏÉÅÎã¥ Ï∂îÍ∞Ä</span>
//           </div>

//         </div>

//         {/* ÏÉÅÎã¥ ÎÇ¥Ïó≠ Ï∂îÍ∞Ä Î™®Îã¨ */}
//         {openAddModal && (
//           <div className="fixed inset-0 flex justify-center items-center bg-gray-500 bg-opacity-50 z-50">
//             <div className="bg-white p-6 rounded-md w-1/2 ">
//               <h3 className="text-xl font-semibold mb-4">ÏÉÅÎã¥ ÎÇ¥Ïó≠ Ï∂îÍ∞Ä</h3>

//               {/* ÏÉÅÎã¥Ïùº Î∞è ÌõÑÏÜç ÎÇ†Ïßú (flexÎ°ú Î∞∞Ïπò) */}
//               <div className="mb-4 grid space-x-4 grid-cols-4">
//                 <div className="">
//                   <label className="block mb-2 text-sm font-medium">
//                     ÏÉÅÎã¥Ïùº
//                   </label>
//                   <input
//                     type="date"
//                     value={newConsultation.date}
//                     readOnly
//                     className="w-full p-2 border border-gray-300 rounded-md text-sm"
//                   />
//                 </div>
//                 <div>
//                   <label className="block mb-2 text-sm font-medium">
//                     ÌõÑÏÜç ÎÇ†Ïßú
//                   </label>
//                   <input
//                     type="date"
//                     value={newConsultation.follow_up_date}
//                     onChange={(e) =>
//                       setNewConsultation({
//                         ...newConsultation,
//                         follow_up_date: e.target.value,
//                       })
//                     }
//                     className="w-full p-2 border border-gray-300 rounded-md text-sm"
//                   />
//                 </div>
//                 <div>
//                   <label className="block mb-2 text-sm font-medium">
//                     Í≥†Í∞ùÎ™Ö
//                   </label>
//                   <select
//                     defaultValue={newConsultation.contact_name}
//                     onChange={(e) =>
//                       setNewConsultation({
//                         ...newConsultation,
//                         contact_name: e.target.value,
//                       })
//                     }
//                     className="w-full p-2 border border-gray-300 rounded-md text-sm"
//                   >
//                     <option value="">Îã¥ÎãπÏûê ÏÑ†ÌÉù</option>
//                     {contacts.map((contact) => (
//                       <option key={contact.id} value={contact.contact_name}>
//                         {contact.contact_name} ({contact.level})
//                       </option>
//                     ))}
//                   </select>
//                 </div>
//                 <div>
//                   <label className="block mb-2 text-sm font-medium">
//                     ÏÉÅÎã¥Ïûê
//                   </label>
//                   <select
//                     value={newConsultation.user_id}
//                     disabled
//                     onChange={(e) =>
//                       setNewConsultation({
//                         ...newConsultation,
//                         user_id: e.target.value,
//                       })
//                     }
//                     className="w-full p-2 border border-gray-300 rounded-md text-sm"
//                   >
//                     {/* Îã§Î•∏ Ïú†Ï†ÄÎì§ */}
//                     {users.map((user) => (
//                       <option key={user.id} value={user.id}>
//                         {user.name} {user.level}
//                       </option>
//                     ))}
//                   </select>
//                 </div>
//               </div>

//               {/* ÏÉÅÎã¥ ÎÇ¥Ïö© */}
//               <div className="mb-4">
//                 <label className="block mb-2 text-sm font-medium">
//                   ÏÉÅÎã¥ ÎÇ¥Ïö©
//                 </label>
//                 <textarea
//                   value={newConsultation.content}
//                   onChange={(e) =>
//                     setNewConsultation({
//                       ...newConsultation,
//                       content: e.target.value,
//                     })
//                   }
//                   className="w-full p-2 border border-gray-300 rounded-md text-sm"
//                   rows={4}
//                 />
//               </div>

//               {/* Î≤ÑÌäº */}
//               <div className="flex justify-end space-x-2">
//                 <button
//                   onClick={() => {
//                     setOpenAddModal(false);
//                     setNewConsultation({
//                       date: new Date().toISOString().split("T")[0],
//                       follow_up_date: "",
//                       user_id: loginUser ? loginUser.id : "",
//                       content: "",
//                       contact_name: "",
//                     });
//                   }}
//                   className={`bg-gray-500 text-white px-4 py-2 rounded-md text-xs md:text-sm ${
//                     saving ? "opacity-50 cursor-not-allowed" : ""
//                   }`}
//                   disabled={saving}
//                 >
//                   Ï∑®ÏÜå
//                 </button>

//                 <button
//                   onClick={handleAddConsultation}
//                   className={`bg-blue-500 text-white px-4 py-2 rounded-md text-xs md:text-sm flex items-center ${
//                     saving ? "opacity-50 cursor-not-allowed" : ""
//                   }`}
//                   disabled={saving}
//                 >
//                   Ï†ÄÏû•
//                   {saving && <CircularProgress size={18} className="ml-2" />}
//                 </button>
//               </div>
//             </div>
//           </div>
//         )}

//         {/* ÏÉÅÎã¥ ÎÇ¥Ïó≠ ÏàòÏ†ï Î™®Îã¨ */}
//         {openEditModal && (
//           <div className="fixed inset-0 flex justify-center items-center bg-gray-500 bg-opacity-50 z-50">
//             <div className="bg-white p-6 rounded-md w-1/2">
//               <h3 className="text-xl font-semibold mb-4">ÏÉÅÎã¥ ÎÇ¥Ïó≠ ÏàòÏ†ï</h3>

//               {/* ÏÉÅÎã¥Ïùº Î∞è ÌõÑÏÜç ÎÇ†Ïßú (flexÎ°ú Î∞∞Ïπò) */}
//               <div className="mb-4 grid grid-cols-4 space-x-4">
//                 <div>
//                   <label className="block mb-2 text-sm font-medium">
//                     ÏÉÅÎã¥Ïùº
//                   </label>
//                   <input
//                     type="date"
//                     value={newConsultation.date}
//                     readOnly
//                     className="w-full p-2 border border-gray-300 rounded-md text-sm"
//                   />
//                 </div>
//                 <div>
//                   <label className="block mb-2 text-sm font-medium">
//                     ÌõÑÏÜç ÎÇ†Ïßú
//                   </label>
//                   <input
//                     type="date"
//                     value={
//                       newConsultation.follow_up_date
//                         ? newConsultation.follow_up_date
//                         : ""
//                     }
//                     onChange={(e) =>
//                       setNewConsultation({
//                         ...newConsultation,
//                         follow_up_date: e.target.value,
//                       })
//                     }
//                     className="w-full p-2 border border-gray-300 rounded-md text-sm"
//                   />
//                 </div>
//                 <div>
//                   <label className="block mb-2 text-sm font-medium">
//                     ÌîºÏÉÅÎã¥Ïûê
//                   </label>
//                   <select
//                     defaultValue={newConsultation.contact_name}
//                     onChange={(e) =>
//                       setNewConsultation({
//                         ...newConsultation,
//                         contact_name: e.target.value,
//                       })
//                     }
//                     className="w-full p-2 border border-gray-300 rounded-md text-sm"
//                   >
//                     <option value="">Îã¥ÎãπÏûê ÏÑ†ÌÉù</option>
//                     {contacts.map((contact) => (
//                       <option key={contact.id} value={contact.contact_name}>
//                         {contact.contact_name} ({contact.department})
//                       </option>
//                     ))}
//                   </select>
//                 </div>
//                 <div>
//                   <label className="block mb-2 text-sm font-medium">
//                     ÏÉÅÎã¥Ïûê
//                   </label>

//                   <select
//                     value={newConsultation.user_id}
//                     disabled
//                     onChange={(e) =>
//                       setNewConsultation({
//                         ...newConsultation,
//                         user_id: e.target.value,
//                       })
//                     }
//                     className="w-full p-2 border border-gray-300 rounded-md text-sm"
//                   >
//                     {users.map((user) => (
//                       <option key={user.id} value={user.id}>
//                         {user.name} {user.level}
//                       </option>
//                     ))}
//                   </select>
//                 </div>
//               </div>

//               {/* ÏÉÅÎã¥ ÎÇ¥Ïö© */}
//               <div className="mb-4">
//                 <label className="block mb-2 text-sm font-medium">
//                   ÏÉÅÎã¥ ÎÇ¥Ïö©
//                 </label>
//                 <textarea
//                   value={newConsultation.content}
//                   onChange={(e) =>
//                     setNewConsultation({
//                       ...newConsultation,
//                       content: e.target.value,
//                     })
//                   }
//                   className="w-full p-2 border border-gray-300 rounded-md text-sm"
//                   rows={4}
//                 />
//               </div>

//               {/* Î≤ÑÌäº */}
//               <div className="flex justify-end space-x-2">
//                 <button
//                   onClick={() => {
//                     setOpenEditModal(false);
//                     setNewConsultation({
//                       date: new Date().toISOString().split("T")[0],
//                       follow_up_date: "",
//                       user_id: "",
//                       content: "",
//                       contact_name: "",
//                     });
//                   }}
//                   className={`bg-gray-500 text-white px-4 py-2 rounded-md text-xs md:text-sm ${
//                     saving ? "opacity-50 cursor-not-allowed" : ""
//                   }`}
//                   disabled={saving}
//                 >
//                   Ï∑®ÏÜå
//                 </button>

//                 <button
//                   onClick={handleUpdateConsultation}
//                   className={`bg-blue-500 text-white px-4 py-2 rounded-md text-xs md:text-sm flex items-center ${
//                     saving ? "opacity-50 cursor-not-allowed" : ""
//                   }`}
//                   disabled={saving}
//                 >
//                   Ï†ÄÏû•
//                   {saving && <CircularProgress size={18} className="ml-2" />}
//                 </button>
//               </div>
//             </div>
//           </div>
//         )}

//         {/* ÏÉÅÎã¥ ÎÇ¥Ïó≠ ÌÖåÏù¥Î∏î */}
//         <div className="bg-[#FBFBFB] rounded-md border">
//           {consultations.length > 0 && (
//             <table className="min-w-full table-auto border-collapse text-center">
//               <thead>
//                 <tr className="bg-gray-100 text-left">
//                   <th className="px-4 py-2 border-b border-r-[1px] text-center">
//                     No.
//                   </th>
//                   <th className="px-4 py-2 border-b border-r-[1px] text-center">
//                     ÎÇ†Ïßú
//                   </th>
//                   <th className="px-4 py-2 border-b border-r-[1px] text-center w-1/12">
//                     ÌîºÏÉÅÎã¥Ïûê
//                   </th>
//                   <th className="px-4 py-2 border-b border-r-[1px] text-center w-1/12">
//                     ÏÉÅÎã¥Ïûê
//                   </th>
//                   <th className="px-4 py-2 border-b border-r-[1px] text-center w-5/12">
//                     ÎÇ¥Ïö©
//                   </th>
//                   <th className="px-4 py-2 border-b border-r-[1px] text-center">
//                     Ï≤¥ÌÅ¨
//                   </th>
//                   <th className="px-4 py-2 border-b border-r-[1px] text-center">
//                     Î¨∏ÏÑú
//                   </th>
//                   <th className="px-4 py-2 border-b border-r-[1px] text-center">
//                     ÏàòÏ†ï
//                   </th>
//                   <th className="px-4 py-2 border-b border-r-[1px] text-center">
//                     ÏÇ≠Ï†ú
//                   </th>
//                 </tr>
//               </thead>
//               <tbody>
//                 {consultations.map((consultation, index) => (
//                   <tr
//                     key={consultation.id}
//                     className="hover:bg-gray-100 border-b"
//                   >
//                     <td className="px-4 py-2 border-r-[1px]">
//                       {consultation.id.slice(0, 4)}
//                     </td>
//                     <td className="px-4 py-2 border-r-[1px]">
//                       {consultation.date}
//                     </td>
//                     <td className="px-4 py-2 border-r-[1px]">
//                       {consultation.contact_name} {consultation.contact_level}
//                     </td>
//                     <td className="px-4 py-2 border-r-[1px]">
//                       {
//                         users.find((user) => user.id === consultation.user_id)
//                           ?.name
//                       }{" "}
//                       {
//                         users.find((user) => user.id === consultation.user_id)
//                           ?.level
//                       }
//                     </td>
//                     <td
//                       className="px-4 py-2 border-r-[1px] w-full text-start"
//                       style={{
//                         minHeight: "120px",
//                         maxHeight: "120px",
//                         overflowY: "auto",
//                         display: "block",
//                       }}
//                     >
//                       {formatContentWithLineBreaks(consultation.content)}
//                     </td>
//                     <td className="px-4 py-2 border-r-[1px]">
//                       {consultation.follow_up_date}
//                     </td>
//                     <td className="px-4 py-2 border-r-[1px]">
//                       <span
//                         className={`mr-2 cursor-pointer ${
//                           consultation.documents.estimate
//                             ? "text-blue-500 hover:font-bold"
//                             : "text-gray-400 hover:text-black"
//                         }`}
//                         onClick={() =>
//                           router.push(
//                             `/documents/estimate?consultId=${consultation.id}&compId=${company?.id}`
//                           )
//                         }
//                       >
//                         Í≤¨Ï†ÅÏÑú
//                       </span>
//                       <span
//                         className={`mr-2 cursor-pointer ${
//                           consultation.documents.order
//                             ? "text-blue-500 hover:font-bold"
//                             : "text-gray-400 hover:text-black"
//                         }`}
//                         onClick={() =>
//                           router.push(
//                             `/documents/order?consultId=${consultation.id}&compId=${company?.id}`
//                           )
//                         }
//                       >
//                         Î∞úÏ£ºÏÑú
//                       </span>
//                       <span
//                         className={`mr-2 cursor-pointer ${
//                           consultation.documents.requestQuote
//                             ? "text-blue-500 hover:font-bold"
//                             : "text-gray-400 hover:text-black"
//                         }`}
//                         onClick={() =>
//                           router.push(
//                             `/documents/requestQuote?consultId=${consultation.id}&compId=${company?.id}`
//                           )
//                         }
//                       >
//                         ÏùòÎ¢∞ÏÑú
//                       </span>
//                     </td>
//                     <td
//                       className={`px-4 py-2 border-r-[1px] ${
//                         loginUser?.id === consultation.user_id &&
//                         "text-blue-500 cursor-pointer"
//                       }`}
//                       onClick={() => {
//                         if (loginUser?.id === consultation.user_id)
//                           handleEditConsultation(consultation);
//                       }}
//                     >
//                       ÏàòÏ†ï
//                     </td>
//                     <td
//                       className={`px-4 py-2 border-r-[1px] ${
//                         loginUser?.id === consultation.user_id &&
//                         "text-red-500 cursor-pointer"
//                       }`}
//                       onClick={() => {
//                         if (loginUser?.id === consultation.user_id)
//                           handleDeleteConsultation(consultation);
//                       }}
//                     >
//                       ÏÇ≠Ï†ú
//                     </td>
//                   </tr>
//                 ))}
//               </tbody>
//             </table>
//           )}
//         </div>

//         {/* ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò */}
//         <div className="flex justify-center mt-4 overflow-x-auto space-x-1 md:space-x-2">
//           <div className="flex justify-center mt-4 space-x-2">
//             <button
//               onClick={prevPage}
//               disabled={currentPage === 1}
//               className="px-3 py-1 border rounded bg-white hover:bg-gray-100"
//             >
//               Ïù¥Ï†Ñ
//             </button>

//             {paginationNumbers().map((page, index) => (
//               <button
//                 key={index}
//                 onClick={() => handlePageClick(Number(page))}
//                 className={`px-3 py-1 border rounded ${
//                   currentPage === page
//                     ? "bg-blue-500 text-white font-bold"
//                     : "bg-gray-50 text-gray-600 hover:bg-gray-200"
//                 }`}
//               >
//                 {page}
//               </button>
//             ))}

//             <button
//               onClick={nextPage}
//               disabled={currentPage === totalPages}
//               className="px-3 py-1 border rounded bg-white hover:bg-gray-100"
//             >
//               Îã§Ïùå
//             </button>
//           </div>
//         </div>
//       </>

//       {openDeleteModal && consultationToDelete && (
//         <div className="fixed inset-0 flex justify-center items-center bg-gray-500 bg-opacity-50 z-50">
//           <div className="bg-white p-6 rounded-md w-1/3 max-w-lg">
//             <h3 className="text-xl font-semibold mb-4">ÏÉÅÎã¥ ÎÇ¥Ïó≠ ÏÇ≠Ï†ú</h3>
//             <p>
//               Ï†ïÎßêÎ°ú "{consultationToDelete.content}"Ïùò ÏÉÅÎã¥ ÎÇ¥Ïó≠ÏùÑ
//               ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?
//             </p>

//             <div className="flex justify-end space-x-4 mt-4">
//               <button
//                 onClick={() => setOpenDeleteModal(false)}
//                 className="bg-gray-500 text-white px-4 py-2 rounded-md text-sm"
//               >
//                 Ï∑®ÏÜå
//               </button>
//               <button
//                 onClick={handleConfirmDelete}
//                 className="bg-red-500 text-white px-4 py-2 rounded-md text-sm"
//               >
//                 ÏÇ≠Ï†ú
//               </button>
//             </div>
//           </div>
//         </div>
//       )}
//       <SnackbarComponent
//         message={snackbarMessage}
//         onClose={() => setSnackbarMessage("")}
//       />
//     </div>
//   );
// }
